<wxs src="./../../wxs/time.wxs" module="timeUtils"></wxs>
<wxs src="./../../wxs/urlUtils.wxs" module="urlUtils"/>
<view class="channel flex-between" wx:if="{{channel}}">
  <view class="channel-info">
    <view class="channel-name">{{channel.name}}</view>
    <view class="channel-attrs flex-start not-importent">
      <view class="channel-attr" wx:for="{{channel.attrs||channel.channelTemplate.attrs}}" wx:key="name">{{item.name}}
      </view>
    </view>
    <view class="channel-template-name flex-start">
      <navigator class="not-importent" url="/pages/channel/template?templateId={{channel.channelTemplate._id}}"><text
          class="ref-content">@{{channel.channelTemplate.name}}</text></navigator>
    </view>
  </view>
  <view class="follow-btn">
    <button bindtap="removeUserChannel" wx:if="{{userChannel}}" size="mini" type="default">已订阅</button>
    <button bindtap="addUserChannel" type="primary" size="mini" wx:else>订阅</button>
  </view>
</view>

<view wx:if="{{channel.openResourceUrl}}" class="no-title-cells">
  <mp-cells>
    <mp-cell link url="/pages/common/browser?url={{urlUtils.encode(channel.openResourceUrl)}}" hover value="网页地址">
    </mp-cell>
  </mp-cells>
</view>

<view class="no-title-cells" wx:if="{{userChannel}}">
  <mp-cells>
    <mp-cell>
      <view>消息通知</view>
      <view slot="footer">
        <switch checked="{{userChannel.notify}}" bindchange="switchNotify" />
      </view>
    </mp-cell>
    <mp-cell>
      <view>置顶</view>
      <view slot="footer">
        <switch checked="{{userChannel.top}}" bindchange="switchTop" />
      </view>
    </mp-cell>
  </mp-cells>
</view>

<view wx:if="{{channel}}" style="padding-bottom:20px;">
  <view class="weui-cells__title">
    <view class="flex-start">
      <view class="dt {{channelDatasWatcherOn && !channel.disabled ?'dt-refreshing':''}}"></view>
      <view>最近变化记录</view>
    </view>
  </view>
  <mp-cells wx:if="{{channelDatas.length}}" footer="{{channelDatas.length>15?'最多展示最近20条记录':''}}">
    <mp-cell wx:for="{{channelDatas}}" wx:key="_id">
      <view class="flex-start channel-data">
        <view class="channle-data-index not-importent">
          <mp-icon icon="time" size="20" color="gray"></mp-icon>
        </view>
        <view class="channel-data-item">
          <view class="channel-data-time not-importent">{{timeUtils.formatPass(item.createTime)}}</view>
          <view class="channel-attr-items">
            <view class="channel-attr-item" wx:for="{{channel.attrs||channel.channelTemplate.attrs}}" wx:key="name"
              wx:for-item="attr">
              <text class="not-importent">{{attr.name}}：</text>
              <text class="attr-value">{{item.data[attr.name]}}</text>
            </view>
          </view>
        </view>
      </view>
    </mp-cell>
  </mp-cells>
</view>